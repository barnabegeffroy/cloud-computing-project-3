{% extends "layout.html" %}
{% block title %}User - John Doe{% endblock %}
{% block content %}
<div class="d-flex">
    <div class="d-flex flex-column user-col text-center me-5">
        <div class="card mb-3 shadow">
            <i class="fa-solid fa-user-circle fa-10x text-primary"></i>
            <div class="card-body">
                <h5 class="card-title">{{ user_data['name'] if ownProfile else user['name'] }}</h5>
                <h6 class="text-secondary">@{{ user_data['username'] if ownProfile else user['username'] }}</h6>
                <p class="card-text">{{ user_data['bio'] if ownProfile else user['bio'] }}</p>
                <hr>
                <p class="card-text">Number of followings : {{ user_data['followings']|length if ownProfile else
                    user['followings']|length }}</p>
                <p class="card-text">Number of followers : {{ user_data['followers']|length if ownProfile else
                    user['followers']|length }}</p>
            </div>
            <div class="card-footer bg-white">
                {% if ownProfile %}
                <button class="btn btn-outline-primary border rounded-pill" data-bs-toggle="modal"
                    data-bs-target="#modal-edit">
                    <i class="fa-solid fa-pencil-alt"></i>
                    Edit
                </button>
                {% else %}
                {% if user.key.name is in user_data['followings'] %}
                <form action="/unfollow" method="post">
                    <input type="hidden" name="following-id" value="{{ user.key.name }}">
                    <button class="btn btn-outline-primary border rounded-pill">
                        <i class="fa-solid fa-ban"></i>
                        Unfollow
                    </button>
                </form>
                {% else %}
                <form action="/follow" method="post">
                    <input type="hidden" name="following-id" value="{{ user.key.name }}">
                    <button type="submit" class="btn btn-outline-primary border rounded-pill">
                        <i class="fa-solid fa-plus"></i>
                        Follow
                    </button>
                </form>
                {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    <div class="d-flex flex-column">
        {% for tweet in tweets %}
        <div class="card tweet mb-3 shadow">
            <div class="card-header bg-white d-flex">
                <div class="card-user d-flex">
                    <i class="fa-solid fa-user-circle fa-4x text-primary"></i>
                    <div class="d-flex flex-column align-items-end pt-2 ms-2">
                        <span class="name">{{ user_data['name'] if ownProfile else user['name'] }}</span>
                        <span class="username text-secondary">@{{ user_data['username'] if ownProfile else
                            user['username'] }}</span>
                    </div>
                </div>
                <div class="date ms-auto">
                    <span class="text-secondary">{{ tweet['date'] }}</span>
                </div>
            </div>
            <div class="card-body">
                <p class="card-text">{{ tweet['content'] }}</p>
            </div>
            {% if ownProfile %}
            <div class="card-footer d-flex bg-white">
                <button class="btn btn-outline-primary border me-3 rounded-pill" data-bs-toggle="modal"
                    data-bs-target="#edit-tweet" data-bs-id="{{ tweet.key.name }}"
                    data-bs-content="{{ tweet['content'] }}">
                    <i class="fa-solid fa-pencil-alt"></i>
                    Edit
                </button>
                <form action="/delete/{{ tweet.key.name }}">
                    <button type="submit" class="btn btn-outline-danger border rounded-pill">
                        <i class="fa-solid fa-trash"></i>
                        Delete
                    </button>
                </form>
            </div>
            {% endif %}
        </div>
        {% endfor %}
        <!-- <div class="card tweet mb-3 shadow">
            <div class="card-header bg-white d-flex">
                <div class="card-user d-flex">
                    <i class="fa-solid fa-user-circle fa-4x text-primary"></i>
                    <div class="d-flex flex-column align-items-end pt-2 ms-2">
                        <span class="name">John Doe</span>
                        <span class="username text-secondary">@johndoe</span>
                    </div>
                </div>
                <div class="date ms-auto">
                    <span class="text-secondary">32m</span>
                </div>
            </div>
            <div class="card-body">
                <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque interdum
                    rutrum
                    sodales. Nullam mattis fermentum libero, non volutpat. Lorem ipsum dolor sit amet, consectetur
                    adipiscing
                    elit. Pellentesque interdum rutrum
                    sodales. Nullam mattis fermentum libero, non volutpat.</p>
                <div class="pop d-flex justify-content-center">
                    <img class="image" src="../static/img.jpg" alt="" height="250px" width="100%">
                </div>
            </div>
        </div>
        <div class="card tweet mb-3 shadow">
            <div class="card-header bg-white d-flex">
                <div class="card-user d-flex">
                    <i class="fa-solid fa-user-circle fa-4x text-primary"></i>
                    <div class="d-flex flex-column align-items-end pt-2 ms-2">
                        <span class="name">John Doe</span>
                        <span class="username text-secondary">@johndoe</span>
                    </div>
                </div>
                <div class="date ms-auto">
                    <span class="text-secondary">32m</span>
                </div>
            </div>
            <div class="card-body">
                <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque interdum
                    rutrum
                    sodales. Nullam mattis fermentum libero, non volutpat. Lorem ipsum dolor sit amet, consectetur
                    adipiscing
                    elit. Pellentesque interdum rutrum
                    sodales. Nullam mattis fermentum libero, non volutpat.</p>
                <div class="pop d-flex justify-content-center">
                    <img class="image" src="../static/img2.jpg" alt="" height="250px">
                </div>
            </div>
        </div> -->
    </div>
</div>

<div class="modal fade" id="imagemodal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <img src="" class="imagepreview">
        </div>
    </div>
</div>

{% if ownProfile %}
<div class="modal fade" id="modal-edit" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit your account</h5>
            </div>
            <div class="modal-body">
                <form action="/edit_user" id="edit-form" method="post">
                    <div class="mb-3">
                        <label for="name" class="form-label">Your name</label>
                        <input type="text" class="form-control" id="name" name="name" value="{{ user_data['name'] }}"
                            required>
                    </div>
                    <div class="mb-3 form-floating">
                        <textarea class="form-control" id="bio-text" name="bio-text"
                            maxlength="140">{{ user_data['bio'] }}</textarea>
                        <label for="bio-text">Your description...</label>
                        <span class="float-end" id="count-tweet"></span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="submit" form="edit-form" class="btn btn-outline-primary border rounded-pill">Edit
                    !</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="edit-tweet" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit tweet</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="form-edit-tweet" action="/edit_tweet" method="post">
                    <input type="hidden" name="tweet-id">
                    <div class="mb-3 form-floating">
                        <textarea class="form-control" id="edit-tweet-text" name="tweet-text"
                            maxlength="280"></textarea>
                        <label for="edit-tweet-text">Tweet content...</label>
                        <span class="float-end" id="edit-count-tweet"></span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="submit" form="form-edit-tweet" class="btn btn-outline-primary border rounded-pill">Update
                    it
                    !</button>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}